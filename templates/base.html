{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}Django Traders 2.0{% endblock %}</title>

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Bootstrap Icons -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css"
    />

    <!-- Custom CSS -->
    <link rel="stylesheet" type="text/css" href="{% static 'css/base.css' %}" />
    {% block extra_css %}{% endblock %}

    <!-- Favicon -->
    <link
      rel="icon"
      type="image/x-icon"
      href="{% static 'images/favicon.ico' %}"
    />
  </head>
  <body>
    <!-- Header/Navigation - Clean & Minimal -->
    <header>
      <div class="header-content">
        <!-- Logo and Title -->
        <a class="logo" href="{% url 'myapp:home' %}"> Django Traders </a>

        <!-- Hamburger Menu Button -->
        <button class="hamburger-menu" id="hamburgerBtn" aria-label="Menu">
          <span></span>
          <span></span>
          <span></span>
        </button>

        <!-- Navigation Links -->
        <nav id="mainNav">
          <ul>
            <li><a href="{% url 'myapp:home' %}">Home</a></li>
            <li><a href="{% url 'myapp:customer_list' %}">Customers</a></li>
            <li><a href="{% url 'myapp:product_list' %}">Products</a></li>

            {% if request.session.user_id %}
            <!-- Dashboard link based on user type -->
            {% if request.session.user_type == 'customer' %}
            <li>
              <a href="{% url 'myapp:customer_dashboard' %}"
                ><i class="bi bi-speedometer2"></i> Dashboard</a
              >
            </li>
            {% elif request.session.user_type == 'employee' %}
            <li>
              <a href="{% url 'myapp:manager_dashboard' %}"
                ><i class="bi bi-bar-chart"></i> Analytics</a
              >
            </li>
            {% endif %} {% endif %}

            <li>
              <a href="{% url 'myapp:cart_view' %}" class="cart-link">
                Cart {% if cart_count > 0 %}
                <span class="cart-badge">{{ cart_count }}</span>
                {% endif %}
              </a>
            </li>

            <!-- User Menu -->
            {% if request.session.user_id %}
            <li class="user-menu">
              <button class="user-dropdown-toggle" id="userMenuBtn" aria-label="User menu">
                <i class="bi bi-person-circle"></i> {{ request.session.user_name|truncatewords:2 }}
              </button>
              <div class="user-dropdown" id="userDropdown">
                <a href="{% url 'myapp:logout' %}">
                  <i class="bi bi-box-arrow-right"></i> Logout
                </a>
              </div>
            </li>
            {% else %}
            <li>
              <a href="{% url 'myapp:login' %}"
                ><i class="bi bi-box-arrow-in-right"></i> Login</a
              >
            </li>
            {% endif %}
          </ul>
        </nav>
      </div>
    </header>

    <!-- Messages (for Django messages framework) -->
    {% if messages %}
    <div class="messages-container">
      {% for message in messages %}
      <div class="alert alert-{{ message.tags }} fade show" role="alert">
        {{ message }}
      </div>
      {% endfor %}
    </div>
    {% endif %}

    <!-- Main content area -->
    <main class="container my-4">{% block content %} {% endblock %}</main>

    <!-- Footer - Clean & Minimal -->
    <footer
      class="text-center text-muted py-3 mt-5"
      style="
        background: #f5f5f7;
        border-top: 1px solid rgba(0, 0, 0, 0.08);
        font-size: 12px;
        color: #6e6e73;
      "
    >
      <div class="container">
        <p class="mb-0">&copy; Fall 2025 Kennedy Page</p>
      </div>
    </footer>

    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Chart.js for data visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <!-- Custom JavaScript for Navigation -->
    <script>
      // Auto-dismiss alerts after 5 seconds
      document.addEventListener("DOMContentLoaded", function () {
        const alerts = document.querySelectorAll(".alert");
        alerts.forEach(function (alert) {
          setTimeout(function () {
            const bsAlert = new bootstrap.Alert(alert);
            bsAlert.close();
          }, 5000); // 5 seconds
        });
      });

      // Hamburger menu toggle
      const hamburgerBtn = document.getElementById("hamburgerBtn");
      const mainNav = document.getElementById("mainNav");

      if (hamburgerBtn) {
        hamburgerBtn.addEventListener("click", function () {
          this.classList.toggle("active");
          mainNav.classList.toggle("active");
        });

        // Close menu when clicking outside
        document.addEventListener("click", function (event) {
          if (
            !hamburgerBtn.contains(event.target) &&
            !mainNav.contains(event.target)
          ) {
            hamburgerBtn.classList.remove("active");
            mainNav.classList.remove("active");
          }
        });
      }

      // User menu toggle (click instead of hover)
      const userMenuBtn = document.getElementById("userMenuBtn");
      const userDropdown = document.getElementById("userDropdown");

      if (userMenuBtn && userDropdown) {
        userMenuBtn.addEventListener("click", function (event) {
          event.stopPropagation();
          userDropdown.classList.toggle("active");
        });

        // Close user dropdown when clicking outside
        document.addEventListener("click", function (event) {
          if (
            !userMenuBtn.contains(event.target) &&
            !userDropdown.contains(event.target)
          ) {
            userDropdown.classList.remove("active");
          }
        });
      }
    </script>

    <!-- Custom JavaScript -->
    {% block extra_js %}{% endblock %}
  </body>
</html>
